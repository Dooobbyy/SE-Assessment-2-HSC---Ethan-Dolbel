{% extends "base.html" %}

{% block title %}
    Dashboard | Real Estate Finance Tracker
{% endblock %}

{% block content %}
    <h1>Dashboard</h1>

    <!-- Top Stats -->
    <div class="stats-grid">
        <div class="card portfolio-value">
            <p>Total Portfolio Value</p>
            <h2>${{ total_portfolio_value|floatformat:2 }}</h2>
        </div>
        <div class="card cash-flow">
            <p>Monthly Cash Flow</p>
            <h2>${{ monthly_cash_flow|floatformat:2 }}</h2>
        </div>
            <!-- Monthly Summary with Dropdown -->
    <div class="card monthly-summary">
        <p>Monthly Summary</p>
        <form id="month-form">
            <label for="month-select">Select Month:</label>
            <select id="month-select" name="month">
                {% for month in months %}
                    <option value="{{ month }}" {% if month == current_month %}selected{% endif %}>
                        {{ month }}
                    </option>
                {% endfor %}
            </select>
        </form>
        <ul id="summary-values">
            <li><strong>Net Profit:</strong> <span style="color: var(--color-positive)">{{ summary_data.netProfit }}</span></li>
            <li><strong>Maintenance Costs:</strong> <span style="color: var(--color-negative)">{{ summary_data.maintenanceCosts }}</span></li>
            <li><strong>Final Cash Flow:</strong> <span style="color: var(--color-gold)">{{ summary_data.finalCashFlow }}</span></li>
        </ul>
    </div>

    <!-- Financial Year Summary -->
    <div class="card yearly-summary">
        <p>Financial Year Summary (2024)</p>
        <ul>
            <li><strong>Total Income:</strong> $50,000</li>
            <li><strong>Total Expenses:</strong> $20,000</li>
            <li><strong>Net Profit:</strong> $30,000</li>
        </ul>
    </div>

    <!-- Quick Metrics -->
    <div class="card metrics">
        <p>Quick Metrics</p>
        <ul>
            <li>Total Properties: <strong>5</strong></li>
            <li>Rent Collected This Month: <strong>$12,000</strong></li>
            <li>Pending Expenses: <strong>$3,500</strong></li>
        </ul>
    </div>

    <!-- Dashboard Tips -->
    <div class="card tips">
        <p>Dashboard Tips</p>
        <ul>
            <li>üìå Add property details under the ‚ÄúProperties‚Äù tab.</li>
            <li>üìà Track monthly rent payments for accurate reports.</li>
            <li>üí° Use the tools section to calculate ROI and mortgage payments.</li>
        </ul>
    </div>

    
    </div>

    <!-- Middle Charts -->
    <div class="charts-section">
        <div class="card income-expense">
            <h3>Income vs Expense</h3>
            
            <!-- Fixed-size chart container -->
            <div style="position: relative; height: 400px;">
                <canvas id="incomeExpenseLineChart"></canvas>
            </div>
            
            <p id="chart-message" style="display: none; text-align: center; color: var(--color-muted);">
                No data available for this month
            </p>
        </div>
    </div>

<!-- Alerts / Reminders -->
    <div class="card alerts">
        <h3>Alerts / Reminders</h3>
        <ul>
            <li>‚ö†Ô∏è Mortgage due next week</li>
            <li>üìÖ Property inspection scheduled</li>
        </ul>
    </div>

<script>
document.addEventListener('DOMContentLoaded', function () {
    const ctx = document.getElementById('incomeExpenseLineChart').getContext('2d');
    
    // Hardcoded 12 months of data
    const labels = ["Jan", "Feb", "Mar", "Apr", "May", "Jun", 
                   "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"];
    
    // Sample data (replace with your actual values)
    const incomeData = [5000, 5500, 6000, 5800, 6200, 6500, 
                       6300, 6800, 7000, 6700, 7200, 7500];
    
    const expenseData = [4000, 4200, 4500, 4300, 4700, 4600, 
                        4400, 4800, 4900, 4600, 5000, 5100];

    new Chart(ctx, {
        type: 'line',
        data: {
            labels: labels,
            datasets: [
                {
                    label: 'Income',
                    data: incomeData,
                    borderColor: '#00C896',
                    backgroundColor: 'rgba(0, 200, 150, 0.2)',
                    tension: 0.4,
                    fill: true,
                    pointRadius: 4,
                    pointHoverRadius: 6
                },
                {
                    label: 'Expenses',
                    data: expenseData,
                    borderColor: '#E04F5F',
                    backgroundColor: 'rgba(224, 79, 95, 0.2)',
                    tension: 0.4,
                    fill: true,
                    pointRadius: 4,
                    pointHoverRadius: 6
                }
            ]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: { 
                    position: 'top',
                    labels: {
                        padding: 20
                    }
                },
                tooltip: {
                    callbacks: {
                        label: (context) => {
                            return `$${parseInt(context.raw).toLocaleString()}`;
                        }
                    }
                }
            },
            scales: {
                x: {
                    ticks: {
                        autoSkip: false,
                        maxRotation: 0,
                        minRotation: 0
                    }
                },
                y: {
                    beginAtZero: true,
                    ticks: {
                        callback: (value) => `$${value.toLocaleString()}`
                    }
                }
            }
        }
    });
});
</script>
{% endblock %}